<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dental Clinic Appointment Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .form-container {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 80px;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-header {
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background-color: #3498db;
            color: white;
        }
        .calendar-cell {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 60px;
            background-color: white;
            cursor: pointer;
        }
        .calendar-cell:hover {
            background-color: #f0f0f0;
        }
        .appointment {
            background-color: #d4edff;
            padding: 3px;
            margin-bottom: 3px;
            border-radius: 3px;
            font-size: 12px;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .time-slot {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 5px 0;
        }
        .time-label {
            width: 80px;
            font-weight: bold;
        }
        .appointment-slot {
            flex-grow: 1;
            cursor: pointer;
        }
        .appointment-slot:hover {
            background-color: #f0f0f0;
        }
        .status-scheduled { background-color: #d4edff; }
        .status-completed { background-color: #d4f7dc; }
        .status-cancelled { background-color: #ffd4d4; }
        .status-special { 
            background-color: #f0d4ff; 
            border-left: 3px solid #9b59b6;
        }
        .time-slot-empty {
            min-height: 20px;
        }
        .data-status {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-style: italic;
            color: #666;
        }
        .clickable {
            cursor: pointer;
        }
        .clickable:hover {
            background-color: #e6f7ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dental Clinic Appointment Tracker</h1>
        
        <div class="data-status" id="data-status">
            Data will be saved in your browser (works offline)
        </div>
        
        <!-- Main Menu -->
        <div id="main-menu" class="menu">
            <button onclick="showView('daily-view')">Daily View</button>
            <button onclick="showView('weekly-view')">Weekly View</button>
            <button onclick="showView('monthly-view')">Monthly View</button>
            <button onclick="showView('manage-procedures')">Manage Procedures</button>
            <button onclick="exportData()">Export Data</button>
            <button onclick="importData()">Import Data</button>
        </div>
        
        <!-- Appointment Form -->
        <div id="appointment-form" class="form-container">
            <h2 id="form-title">New Appointment</h2>
            <div class="form-group">
                <label for="patient-name">Patient Name:</label>
                <input type="text" id="patient-name" required>
            </div>
            <div class="form-group">
                <label for="patient-phone">Phone:</label>
                <input type="text" id="patient-phone">
            </div>
            <div class="form-group">
                <label for="procedure">Procedure:</label>
                <select id="procedure"></select>
            </div>
            <div class="form-group">
                <label for="appt-date">Date:</label>
                <input type="date" id="appt-date" required>
            </div>
            <div class="form-group">
                <label for="start-time">Start Time:</label>
                <select id="start-time"></select>
            </div>
            <div class="form-group">
                <label for="duration">Duration:</label>
                <select id="duration">
                    <option value="30">30 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="90">1.5 hours</option>
                    <option value="120">2 hours</option>
                    <option value="180">3 hours</option>
                    <option value="240">4 hours</option>
                </select>
            </div>
            <div class="form-group">
                <label for="status">Status:</label>
                <select id="status">
                    <option value="Scheduled">Scheduled</option>
                    <option value="Completed">Completed</option>
                    <option value="Cancelled">Cancelled</option>
                    <option value="No-Show">No-Show</option>
                    <option value="Special">Special (can overlap)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="notes">Notes:</label>
                <textarea id="notes"></textarea>
            </div>
            <div class="form-group">
                <button onclick="saveAppointment()" id="save-btn">Save</button>
                <button onclick="hideForm()">Cancel</button>
                <button onclick="deleteAppointment()" id="delete-btn" style="background-color: #e74c3c; display: none;">Delete</button>
            </div>
        </div>
        
        <!-- Daily View -->
        <div id="daily-view" class="form-container">
            <h2>Daily View</h2>
            <div class="nav-buttons">
                <button onclick="changeDay(-1)">◀ Previous Day</button>
                <button onclick="goToToday()">Today</button>
                <button onclick="changeDay(1)">Next Day ▶</button>
            </div>
            <h3 id="daily-date"></h3>
            <div id="time-slots"></div>
            <button onclick="showView('main-menu')">Back to Menu</button>
        </div>
        
        <!-- Weekly View -->
        <div id="weekly-view" class="form-container">
            <h2>Weekly View</h2>
            <div class="nav-buttons">
                <button onclick="changeWeek(-1)">◀ Previous Week</button>
                <button onclick="goToCurrentWeek()">Current Week</button>
                <button onclick="changeWeek(1)">Next Week ▶</button>
            </div>
            <h3 id="weekly-date"></h3>
            <div class="calendar" id="weekly-calendar"></div>
            <button onclick="showView('main-menu')">Back to Menu</button>
        </div>
        
        <!-- Monthly View -->
        <div id="monthly-view" class="form-container">
            <h2>Monthly View</h2>
            <div class="nav-buttons">
                <button onclick="changeMonth(-1)">◀ Previous Month</button>
                <button onclick="goToCurrentMonth()">Current Month</button>
                <button onclick="changeMonth(1)">Next Month ▶</button>
            </div>
            <h3 id="monthly-date"></h3>
            <div class="calendar" id="monthly-calendar"></div>
            <button onclick="showView('main-menu')">Back to Menu</button>
        </div>
        
        <!-- Manage Procedures -->
        <div id="manage-procedures" class="form-container">
            <h2>Manage Procedures</h2>
            <div class="form-group">
                <label>Add New Procedure:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="new-procedure" style="flex-grow: 1;">
                    <button onclick="addProcedure()">Add</button>
                </div>
            </div>
            <div class="form-group">
                <h3>Current Procedures:</h3>
                <ul id="procedures-list" style="list-style-type: none; padding: 0;"></ul>
            </div>
            <button onclick="showView('main-menu')">Back to Menu</button>
        </div>
    </div>

    <script>
        // Data Management
        let appointments = JSON.parse(localStorage.getItem('dentalAppointments')) || [];
        let procedures = JSON.parse(localStorage.getItem('dentalProcedures')) || [
            "Cleaning", "Filling", "Extraction", "Root Canal", "Checkup"
        ];
        let currentViewDate = new Date();
        let currentEditingAppt = null;

        // Initialize the app
        function init() {
            populateTimeSlots();
            updateProcedureDropdown();
            updateProcedureList();
            updateDailyView();
            updateWeeklyView();
            updateMonthlyView();
            document.getElementById('appt-date').valueAsDate = new Date();
        }

        // View Navigation
        function showView(viewId) {
            document.querySelectorAll('.form-container').forEach(view => {
                view.style.display = 'none';
            });
            document.getElementById(viewId).style.display = 'block';
            
            if (viewId === 'daily-view') updateDailyView();
            if (viewId === 'weekly-view') updateWeeklyView();
            if (viewId === 'monthly-view') updateMonthlyView();
            if (viewId === 'manage-procedures') updateProcedureList();
        }

        function hideForm() {
            document.getElementById('appointment-form').style.display = 'none';
            currentEditingAppt = null;
        }

        // Time Slots
        function populateTimeSlots() {
            const select = document.getElementById('start-time');
            select.innerHTML = '';
            
            for (let hour = 8; hour < 18; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const time = new Date();
                    time.setHours(hour, minute, 0, 0);
                    const option = document.createElement('option');
                    option.value = time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    option.textContent = option.value;
                    select.appendChild(option);
                }
            }
        }

        // Procedures Management
        function updateProcedureDropdown() {
            const select = document.getElementById('procedure');
            select.innerHTML = '';
            procedures.forEach(proc => {
                const option = document.createElement('option');
                option.value = proc;
                option.textContent = proc;
                select.appendChild(option);
            });
        }

        function updateProcedureList() {
            const list = document.getElementById('procedures-list');
            list.innerHTML = '';
            procedures.forEach(proc => {
                const li = document.createElement('li');
                li.style.margin = '5px 0';
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                
                const text = document.createElement('span');
                text.textContent = proc;
                text.style.flexGrow = '1';
                
                const btn = document.createElement('button');
                btn.textContent = 'Remove';
                btn.style.marginLeft = '10px';
                btn.onclick = () => removeProcedure(proc);
                
                li.appendChild(text);
                li.appendChild(btn);
                list.appendChild(li);
            });
        }

        function addProcedure() {
            const input = document.getElementById('new-procedure');
            const proc = input.value.trim();
            if (proc && !procedures.includes(proc)) {
                procedures.push(proc);
                saveData();
                updateProcedureDropdown();
                updateProcedureList();
                input.value = '';
            }
        }

        function removeProcedure(proc) {
            procedures = procedures.filter(p => p !== proc);
            saveData();
            updateProcedureDropdown();
            updateProcedureList();
        }

        // Appointment Management
        function openAppointmentForm(date, time = null, appointment = null) {
            document.getElementById('form-title').textContent = 
                appointment ? 'Edit Appointment' : 'New Appointment';
            
            document.getElementById('appt-date').valueAsDate = date;
            
            if (time) {
                document.getElementById('start-time').value = 
                    time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }
            
            if (appointment) {
                document.getElementById('patient-name').value = appointment.patientName;
                document.getElementById('patient-phone').value = appointment.patientPhone;
                document.getElementById('procedure').value = appointment.procedure;
                document.getElementById('duration').value = appointment.duration;
                document.getElementById('status').value = appointment.status;
                document.getElementById('notes').value = appointment.notes;
                document.getElementById('delete-btn').style.display = 'inline-block';
                currentEditingAppt = appointment;
            } else {
                document.getElementById('patient-name').value = '';
                document.getElementById('patient-phone').value = '';
                document.getElementById('notes').value = '';
                document.getElementById('delete-btn').style.display = 'none';
                currentEditingAppt = null;
            }
            
            showView('appointment-form');
            document.getElementById('patient-name').focus();
        }

        function saveAppointment() {
            const patientName = document.getElementById('patient-name').value.trim();
            if (!patientName) {
                alert('Please enter patient name');
                return;
            }
            
            const apptDate = document.getElementById('appt-date').value;
            const startTime = document.getElementById('start-time').value;
            const duration = parseInt(document.getElementById('duration').value);
            const status = document.getElementById('status').value;
            
            const startDateTime = new Date(`${apptDate}T${startTime}`);
            const endDateTime = new Date(startDateTime.getTime() + duration * 60000);
            
            // Check for conflicts (unless special appointment)
            if (status !== "Special") {
                const conflict = appointments.some(apt => {
                    if (currentEditingAppt && apt.id === currentEditingAppt.id) return false;
                    const aptStart = new Date(apt.startTime);
                    const aptEnd = new Date(apt.endTime);
                    return (startDateTime < aptEnd && endDateTime > aptStart);
                });
                
                if (conflict) {
                    alert('Time slot already booked!');
                    return;
                }
            }
            
            const appointment = {
                id: currentEditingAppt ? currentEditingAppt.id : Date.now(),
                patientName: patientName,
                patientPhone: document.getElementById('patient-phone').value,
                procedure: document.getElementById('procedure').value,
                startTime: startDateTime.toISOString(),
                endTime: endDateTime.toISOString(),
                duration: duration,
                status: status,
                notes: document.getElementById('notes').value,
                isSpecial: status === "Special"
            };
            
            if (currentEditingAppt) {
                // Update existing appointment
                const index = appointments.findIndex(a => a.id === currentEditingAppt.id);
                if (index !== -1) appointments[index] = appointment;
            } else {
                // Add new appointment
                appointments.push(appointment);
            }
            
            saveData();
            hideForm();
            
            // Update views
            updateDailyView();
            updateWeeklyView();
            updateMonthlyView();
        }

        function deleteAppointment() {
            if (currentEditingAppt && confirm('Delete this appointment?')) {
                appointments = appointments.filter(a => a.id !== currentEditingAppt.id);
                saveData();
                hideForm();
                updateDailyView();
                updateWeeklyView();
                updateMonthlyView();
            }
        }

        // Calendar Views
        function updateDailyView() {
            const dateStr = currentViewDate.toLocaleDateString(undefined, { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });
            document.getElementById('daily-date').textContent = dateStr;
            
            const container = document.getElementById('time-slots');
            container.innerHTML = '';
            
            // Get today's appointments
            const dayApps = appointments.filter(apt => {
                const aptDate = new Date(apt.startTime);
                return aptDate.toDateString() === currentViewDate.toDateString();
            });
            
            // Create time slots
            for (let hour = 8; hour < 18; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const slotTime = new Date(currentViewDate);
                    slotTime.setHours(hour, minute, 0, 0);
                    
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'time-slot clickable';
                    slotDiv.onclick = () => openAppointmentForm(currentViewDate, slotTime);
                    
                    const timeLabel = document.createElement('div');
                    timeLabel.className = 'time-label';
                    timeLabel.textContent = slotTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    const apptSlot = document.createElement('div');
                    apptSlot.className = 'appointment-slot';
                    
                    // Check for appointment at this time
                    const appointment = dayApps.find(apt => {
                        const start = new Date(apt.startTime);
                        const end = new Date(apt.endTime);
                        return slotTime >= start && slotTime < end;
                    });
                    
                    if (appointment) {
                        const apptDiv = document.createElement('div');
                        apptDiv.className = `appointment status-${appointment.status.toLowerCase()}`;
                        if (appointment.isSpecial) apptDiv.classList.add('status-special');
                        
                        apptDiv.innerHTML = `
                            <strong>${appointment.patientName}</strong><br>
                            ${appointment.procedure}<br>
                            ${new Date(appointment.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) - 
                            ${new Date(appointment.endTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            ${appointment.isSpecial ? '<br>(Special)' : ''}
                        `;
                        apptDiv.onclick = (e) => {
                            e.stopPropagation();
                            openAppointmentForm(
                                new Date(appointment.startTime), 
                                new Date(appointment.startTime), 
                                appointment
                            );
                        };
                        apptSlot.appendChild(apptDiv);
                    }
                    
                    slotDiv.appendChild(timeLabel);
                    slotDiv.appendChild(apptSlot);
                    container.appendChild(slotDiv);
                }
            }
        }

        function updateWeeklyView() {
            const startOfWeek = new Date(currentViewDate);
            startOfWeek.setDate(currentViewDate.getDate() - currentViewDate.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            document.getElementById('weekly-date').textContent = 
                `Week of ${startOfWeek.toLocaleDateString(undefined, {month: 'long', day: 'numeric'})} - 
                ${endOfWeek.toLocaleDateString(undefined, {month: 'long', day: 'numeric', year: 'numeric'})}`;
            
            const calendar = document.getElementById('weekly-calendar');
            calendar.innerHTML = '';
            
            // Create headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Get week's appointments
            const weekApps = appointments.filter(apt => {
                const aptDate = new Date(apt.startTime);
                return aptDate >= startOfWeek && aptDate <= endOfWeek;
            });
            
            // Create days
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-cell clickable';
                dayCell.onclick = () => {
                    currentViewDate = new Date(day);
                    showView('daily-view');
                };
                
                const dayNumber = document.createElement('div');
                dayNumber.textContent = day.getDate();
                dayCell.appendChild(dayNumber);
                
                // Add day's appointments
                const dayApps = weekApps.filter(apt => {
                    const aptDate = new Date(apt.startTime);
                    return aptDate.toDateString() === day.toDateString();
                });
                
                dayApps.forEach(apt => {
                    const apptDiv = document.createElement('div');
                    apptDiv.className = `appointment status-${apt.status.toLowerCase()}`;
                    if (apt.isSpecial) apptDiv.classList.add('status-special');
                    apptDiv.textContent = `${apt.patientName.split(' ')[0]}. - ${apt.procedure.substring(0, 3)}`;
                    apptDiv.onclick = (e) => {
                        e.stopPropagation();
                        openAppointmentForm(
                            new Date(apt.startTime), 
                            new Date(apt.startTime), 
                            apt
                        );
                    };
                    dayCell.appendChild(apptDiv);
                });
                
                calendar.appendChild(dayCell);
            }
        }

        function updateMonthlyView() {
            const month = currentViewDate.getMonth();
            const year = currentViewDate.getFullYear();
            
            document.getElementById('monthly-date').textContent = 
                currentViewDate.toLocaleDateString(undefined, {month: 'long', year: 'numeric'});
            
            const calendar = document.getElementById('monthly-calendar');
            calendar.innerHTML = '';
            
            // Create headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Get first/last day of month
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Get month's appointments
            const monthApps = appointments.filter(apt => {
                const aptDate = new Date(apt.startTime);
                return aptDate.getMonth() === month && aptDate.getFullYear() === year;
            });
            
            // Add empty cells for days before month start
            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-cell';
                calendar.appendChild(emptyCell);
            }
            
            // Add days
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-cell clickable';
                dayCell.onclick = () => {
                    currentViewDate = new Date(date);
                    showView('daily-view');
                };
                
                const dayNumber = document.createElement('div');
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // Check for appointments
                const hasAppt = monthApps.some(apt => {
                    const aptDate = new Date(apt.startTime);
                    return aptDate.getDate() === day;
                });
                
                if (hasAppt) {
                    const dot = document.createElement('div');
                    dot.style.textAlign = 'center';
                    dot.innerHTML = '•';
                    dot.style.color = '#3498db';
                    dot.style.fontSize = '24px';
                    dayCell.appendChild(dot);
                }
                
                calendar.appendChild(dayCell);
            }
        }

        // Navigation
        function changeDay(days) {
            currentViewDate.setDate(currentViewDate.getDate() + days);
            updateDailyView();
        }

        function goToToday() {
            currentViewDate = new Date();
            updateDailyView();
        }

        function changeWeek(weeks) {
            currentViewDate.setDate(currentViewDate.getDate() + weeks * 7);
            updateWeeklyView();
        }

        function goToCurrentWeek() {
            currentViewDate = new Date();
            updateWeeklyView();
        }

        function changeMonth(months) {
            currentViewDate.setMonth(currentViewDate.getMonth() + months);
            updateMonthlyView();
        }

        function goToCurrentMonth() {
            currentViewDate = new Date();
            updateMonthlyView();
        }

        // Data Persistence
        function saveData() {
            localStorage.setItem('dentalAppointments', JSON.stringify(appointments));
            localStorage.setItem('dentalProcedures', JSON.stringify(procedures));
            document.getElementById('data-status').textContent = 
                `Data saved (${new Date().toLocaleString()})`;
        }

        function exportData() {
            const data = {
                appointments: appointments,
                procedures: procedures,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `dental_appointments_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (confirm(`Import ${data.appointments?.length || 0} appointments and ${data.procedures?.length || 0} procedures?`)) {
                            appointments = data.appointments || [];
                            procedures = data.procedures || [];
                            saveData();
                            init();
                            alert('Data imported successfully!');
                        }
                    } catch (error) {
                        alert('Error importing data: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Start the app
        init();
    </script>
</body>
</html>